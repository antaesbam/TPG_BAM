PUT _ingest/pipeline/tpgbam_mnc_dev_pipeline
{
    "description": "TPGBAM SCS DATT ingestion",
    "processors": [
      {
        "grok": {
          "field": "message",
          "patterns": ["%{WORD:channel},%{DATA:uid},%{WORD:business_object},%{DATA:as_of_time},%{SHORT_DATE:as_of},%{DATA:cost},%{DATA:delivery_status},%{DATA:messdate},%{DATA:terminal_id},%{DATA:terminal_location_id},%{DATA:terminal_location_name},%{DATA:bus_stop_id},%{DATA:bus_stop_name},%{DATA:rate_id},%{DATA:item_id},%{DATA:terminal_type},%{DATA:payment_terminal_id},%{DATA:delivery_proof},%{DATA:delivery_proof_name},%{DATA:delivery_proof_id},%{DATA:transaction_id},%{DATA:latitude},%{DATA:longitude},%{DATA:cartabonus_id},%{DATA:distance},%{DATA:discount},%{DATA:class_option},%{DATA:cost_chf},%{DATA:sum_payments_chf},%{DATA:sum_payments_eur},%{DATA:sum_combined_payment_cartabonus},%{DATA:payment_type},%{DATA:credit_card_info},%{DATA:sum_combined_payment_cash},%{DATA:terminal_transaction_id},%{DATA:zone_origin},%{DATA:zone_destination},%{DATA:via_receipt_description}"],
          "pattern_definitions": {
            "SHORT_DATE": "%{YEAR}-%{MONTHNUM}-%{MONTHDAY}"
          }
        }
      },
      {
        "gsub": {
          "field": "cost",
          "pattern": ",",
          "replacement": "."
        }
      },
      {
        "gsub": {
          "field": "messdate",
          "pattern": " ",
          "replacement": "T"
        }
      },
      {
        "date" : {
          "field" : "messdate",
          "formats" : ["ISO8601"],
          "timezone" : "Europe/Paris"
        }
      },
      {
        "remove": {
          "field": "message"
        }
      },
      {
        "set": {
          "field": "_type",
          "value": "tpg_vente"
        }
      },
      {
        "set": {
          "field": "_index",
          "value": "tpgbam_scs_dev_index"
        }
      }
    ]
}