PUT _ingest/pipeline/tpgbam_mnc_dev_pipeline
{
    "description": "TPGBAM MNC SMS ingestion",
    "processors": [
      {
        "grok": {
          "field": "message",
          "patterns": ["%{DATA:uid},%{WORD:channel},%{WORD:business_object},%{SHORT_DATE:as_of},%{DATA:as_of_time},%{DATA:cost},%{WORD:currency},%{WORD:delivery_status},(%{WORD:failed_code})?,(%{WORD:failed_message})?,(%{WORD:failed_reason})?,%{DATA:messdate},%{WORD:operator},%{DATA:phone},%{WORD:theme},%{WORD:delivery_proof}"],
          "pattern_definitions": {
            "SHORT_DATE": "%{YEAR}-%{MONTHNUM}-%{MONTHDAY}"
          }
        }
      },
      {
        "gsub": {
          "field": "cost",
          "pattern": ",",
          "replacement": "."
        }
      },
      {
        "date" : {
          "field" : "messdate",
          "formats" : ["yyyy-MM-dd HH:mm:ss.SSS+MM"],
          "timezone" : "Europe/Amsterdam"
        }
      },
      {
        "remove": {
          "field": "message"
        }
      },
      {
        "set": {
          "field": "_type",
          "value": "tpg_vente"
        }
      },
      {
        "set": {
          "field": "_index",
          "value": "tpgbam_dev_mnc_index"
        }
      }
    ],
  "on_failure": [
    {
      "set": {
        "field": "error",
        "value": "BAD TPGBAM MNC SMS MESSAGE"
      }
    }
  ]
}